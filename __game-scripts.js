var FollowCamera=pc.createScript("followCamera");FollowCamera.attributes.add("target",{type:"entity",title:"Target",description:"The Entity to follow"}),FollowCamera.attributes.add("distance",{type:"number",default:4,title:"Distance",description:"How far from the Entity should the follower be"}),FollowCamera.prototype.initialize=function(){this.pos=new pc.Vec3,this.offset=new pc.Vec3},FollowCamera.prototype.postUpdate=function(t){this.target&&(this.offset.set(.75,1,.75).scale(this.distance),this.pos.copy(this.target.getPosition()).add(this.offset),this.pos.lerp(this.entity.getPosition(),this.pos,.1),this.entity.setPosition(this.pos))};var Movement=pc.createScript("movement");Movement.attributes.add("speed",{type:"number",default:.1,min:.05,max:.5,precision:2,description:"Controls the movement speed"}),Movement.prototype.initialize=function(){this.force=new pc.Vec3,this.spawnPos=this.entity.getPosition().clone()},Movement.prototype.update=function(e){if(this.entity.getPosition().y<-1)return void this.teleport(this.spawnPos);const t=this.app.keyboard;let s=0,i=0;if((t.isPressed(pc.KEY_LEFT)||t.isPressed(pc.KEY_A))&&(s=-this.speed),(t.isPressed(pc.KEY_RIGHT)||t.isPressed(pc.KEY_D))&&(s+=this.speed),(t.isPressed(pc.KEY_UP)||t.isPressed(pc.KEY_W))&&(i=-this.speed),(t.isPressed(pc.KEY_DOWN)||t.isPressed(pc.KEY_S))&&(i+=this.speed),this.force.set(s,0,i),this.force.lengthSq()>0){this.force.normalize().scale(this.speed);const e=.25*-Math.PI,t=Math.cos(e),s=Math.sin(e),i=this.force.x*t-this.force.z*s,o=this.force.z*t+this.force.x*s;this.force.set(i,0,o)}this.entity.rigidbody.applyImpulse(this.force)},Movement.prototype.teleport=function(e){this.entity.rigidbody.teleport(e),this.spawnPos.copy(e),this.entity.rigidbody.linearVelocity=pc.Vec3.ZERO,this.entity.rigidbody.angularVelocity=pc.Vec3.ZERO};var Teleporter=pc.createScript("teleporter");Teleporter.attributes.add("target",{type:"entity",title:"Target Entity",description:"The target entity where we are going to teleport"}),Teleporter.prototype.initialize=function(){const onTriggerEnter=t=>{if(t.script.movement){const e=this.target.getPosition().clone();e.y+=.5,t.script.movement.teleport(e)}};this.entity.collision.on("triggerenter",onTriggerEnter),this.on("destroy",(()=>{this.entity.collision.off("triggerenter",onTriggerEnter)}))};var FirstPersonMovement=pc.createScript("firstPersonMovement");FirstPersonMovement.attributes.add("camera",{type:"entity",description:"Optional, assign a camera entity, otherwise one is created"}),FirstPersonMovement.attributes.add("power",{type:"number",default:2500,description:"Adjusts the speed of player movement"}),FirstPersonMovement.attributes.add("lookSpeed",{type:"number",default:.25,description:"Adjusts the sensitivity of looking"}),FirstPersonMovement.prototype.initialize=function(){this.force=new pc.Vec3,this.eulers=new pc.Vec3;var e=this.app;e.mouse.on("mousemove",this._onMouseMove,this),e.mouse.on("mousedown",(function(){e.mouse.enablePointerLock()}),this),this.entity.collision||console.error("First Person Movement script needs to have a 'collision' component"),this.entity.rigidbody&&this.entity.rigidbody.type===pc.BODYTYPE_DYNAMIC||console.error("First Person Movement script needs to have a DYNAMIC 'rigidbody' component")},FirstPersonMovement.prototype.update=function(e){this.camera||this._createCamera();var t=this.force,s=this.app,o=this.camera.forward,i=this.camera.right,r=0,n=0;(s.keyboard.isPressed(pc.KEY_A)||s.keyboard.isPressed(pc.KEY_Q))&&(r-=i.x,n-=i.z),s.keyboard.isPressed(pc.KEY_D)&&(r+=i.x,n+=i.z),s.keyboard.isPressed(pc.KEY_W)&&(r+=o.x,n+=o.z),s.keyboard.isPressed(pc.KEY_S)&&(r-=o.x,n-=o.z),0===r&&0===n||(t.set(r,0,n).normalize().scale(this.power),this.entity.rigidbody.applyForce(t)),this.camera.setLocalEulerAngles(this.eulers.y,this.eulers.x,0)},FirstPersonMovement.prototype._onMouseMove=function(e){(pc.Mouse.isPointerLocked()||e.buttons[0])&&(this.eulers.x-=this.lookSpeed*e.dx,this.eulers.y-=this.lookSpeed*e.dy)},FirstPersonMovement.prototype._createCamera=function(){this.camera=new pc.Entity,this.camera.setName("First Person Camera"),this.camera.addComponent("camera"),this.entity.addChild(this.camera),this.camera.translateLocal(0,.5,0)};var TouchJoystick=pc.createScript("touchJoystick");TouchJoystick.attributes.add("identifier",{type:"string",default:"joystick0",title:"Idenitifier",description:"A unique name for the joystick to refer to it by in the API. Joysticks are also buttons so this will also be the name of button in the API. It will give a warning in browser tools if the name is not unique."}),TouchJoystick.attributes.add("type",{type:"string",default:"fixed",enum:[{"Fixed in place":"fixed"},{"Move to first touch and fixed":"relative"},{"Move to first touch and drags":"drag"}],title:"Type",description:"Set type of behavior for the joystick."}),TouchJoystick.attributes.add("baseEntity",{type:"entity",title:"Base Entity",description:"Image Element Entity that shows the base of the joystick."}),TouchJoystick.attributes.add("nubEntity",{type:"entity",title:"Nub Entity",description:"Image Element Entity that shows the nub (top) of the joystick."}),TouchJoystick.attributes.add("axisDeadZone",{type:"number",default:10,title:"Axis Dead Zone",description:"The number of UI units from the position of the Base Entity where input is not registered."}),TouchJoystick.attributes.add("axisRange",{type:"number",default:50,title:"Axis Range",description:"The number of UI units from the position of the Base Entity that the Nub Entity can move to and is the maximum range"}),TouchJoystick.attributes.add("hideOnRelease",{type:"boolean",default:!1,title:"Hide on Release",description:"Will only show the joystick when the user is using it and will hide it on touch end. This is commonly used if you don't want the joystick to block what's being shown on screen."}),TouchJoystick.attributes.add("positionOnRelease",{type:"string",default:"stay",enum:[{Stay:"stay"},{Original:"original"},{"Last start":"lastStart"}],title:"Position on Release",description:"Where to move the joystick on release and can help keep the screen tidy so that there are clear areas to show the game and arrange controls."}),TouchJoystick.attributes.add("vibrationPress",{type:"number",default:0,title:"Vibration duration (ms)",description:"If the device supports vibration with 'Navigator.vibrate', it will vibrate for the duration set here on touch down.Set to 0 to disable."}),TouchJoystick.prototype.initialize=function(){window.touchJoypad&&void 0!==window.touchJoypad.sticks[this.identifier]?console.warn("Touch joystick identifier already used, please use another for Entity: "+this.entity.name):(this._originalLocalPosition=this.baseEntity.getLocalPosition().clone(),this._lastPointerDownPosition=new pc.Vec3,this._setAxisValues(0,0),this._inputDown=!1,this._pointerId=-1,this._canVibrate=!!navigator.vibrate,this._setButtonState(!1),this.on("state",(t=>{this._setEvents(t?"on":"off")})),this.on("destroy",(()=>{window.touchJoypad&&(window.touchJoypad.sticks[this.identifier]=void 0)})),this._setEvents("on"))},TouchJoystick.prototype._setEvents=function(t){this._setAxisValues(0,0),this._pointerDown=!1,this._pointerId=-1,this.baseEntity.enabled=!this.hideOnRelease,this.entity.element[t]("mousedown",this._onMouseDown,this),this.entity.element[t]("mousemove",this._onMouseMove,this),this.entity.element[t]("mouseup",this._onMouseUp,this),this.app.touch&&(this.entity.element[t]("touchstart",this._onTouchDown,this),this.entity.element[t]("touchmove",this._onTouchMove,this),this.entity.element[t]("touchend",this._onTouchUp,this),this.entity.element[t]("touchcancel",this._onTouchUp,this))},TouchJoystick.__uiPos=new pc.Vec2,TouchJoystick.prototype.screenToUi=function(t){const i=TouchJoystick.__uiPos,o=this.app.graphicsDevice.canvas.clientWidth,e=this.app.graphicsDevice.canvas.clientHeight;return i.x=t.x/o,i.y=t.y/e,i.mulScalar(2).subScalar(1),i.y*=-1,i},TouchJoystick.prototype._onMouseDown=function(t){t.id=0,this._onPointerDown(t),this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onMouseMove=function(t){t.id=0,this._onPointerMove(t),this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onMouseUp=function(t){t.id=0,this._pointerDown&&t.stopPropagation(),this._onPointerUp(t)},TouchJoystick.prototype._onTouchDown=function(t){if(this._pointerDown)return;const i=this._pointerDown;t.id=t.touch.identifier,this._onPointerDown(t),!i&&this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onTouchMove=function(t){t.id=t.touch.identifier,this._onPointerMove(t),this._pointerDown&&t.stopPropagation(),t.event.preventDefault()},TouchJoystick.prototype._onTouchUp=function(t){this._pointerDown&&(t.id=t.touch.identifier,this._onPointerUp(t),t.stopPropagation()),t.event.preventDefault()},TouchJoystick.prototype._onPointerDown=function(t){const i=this.screenToUi(t);switch(this.type){case"drag":case"relative":this.baseEntity.setPosition(i.x,i.y,0),this.nubEntity.setLocalPosition(0,0,0),this._pointerDown=!0;break;case"fixed":this.nubEntity.setPosition(i.x,i.y,0),this._updateAxisValuesFromNub(),this._pointerDown=!0}this._pointerDown&&(this._canVibrate&&0!==this.vibrationPress&&navigator.vibrate(this.vibrationPress),this._pointerId=t.id?t.id:0,this._setButtonState(!0),this._lastPointerDownPosition.copy(this.baseEntity.getLocalPosition()),this.baseEntity.enabled=!0,this._onPointerMove(t))},TouchJoystick.__tempNubPos=new pc.Vec3,TouchJoystick.__tempBasePos=new pc.Vec3,TouchJoystick.prototype._onPointerMove=function(t){if(this._pointerDown&&this._pointerId==t.id){const i=this.screenToUi(t),o=this.axisRange*this.axisRange;this.nubEntity.setPosition(i.x,i.y,0);const e=TouchJoystick.__tempNubPos;e.copy(this.nubEntity.getLocalPosition());if(e.lengthSq()>=o){if("drag"===this.type){const t=e.length()-this.axisRange,i=TouchJoystick.__tempBasePos;i.copy(e),i.normalize().mulScalar(t),i.add(this.baseEntity.getLocalPosition()),this.baseEntity.setLocalPosition(i)}e.normalize().mulScalar(this.axisRange),this.nubEntity.setLocalPosition(e)}this._updateAxisValuesFromNub()}},TouchJoystick.prototype._onPointerUp=function(t){if(this._pointerDown&&this._pointerId==t.id){switch(this.nubEntity.setLocalPosition(0,0,0),this.hideOnRelease&&(this.baseEntity.enabled=!1),this.positionOnRelease){case"original":this.baseEntity.setLocalPosition(this._originalLocalPosition);break;case"lastStart":this.baseEntity.setLocalPosition(this._lastPointerDownPosition)}this._pointerId=-1,this._updateAxisValuesFromNub(),this._setButtonState(!1),this._pointerDown=!1}},TouchJoystick.prototype._updateAxisValuesFromNub=function(){const t=this.axisRange-this.axisDeadZone,i=this.nubEntity.getLocalPosition(),o=Math.sign(i.x),e=Math.sign(i.y),s=pc.math.clamp(Math.abs(i.x)-this.axisDeadZone,0,t)*o,n=pc.math.clamp(Math.abs(i.y)-this.axisDeadZone,0,t)*e;this._setAxisValues(s/t,n/t)},TouchJoystick.prototype._setAxisValues=function(t,i){window.touchJoypad&&(window.touchJoypad.sticks[this.identifier]={x:t,y:i}),this.axisX=t,this.axisY=i},TouchJoystick.prototype._setButtonState=function(t){window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=t?Date.now():null),this._state=t};var TouchButton=pc.createScript("touchButton");TouchButton.attributes.add("identifier",{type:"string",default:"button0",title:"Identifier",description:"A unique name for the button to refer to it by in the API. Will give a warning in browser tools if the name is not unique."}),TouchButton.attributes.add("vibration",{type:"number",default:0,title:"Vibration duration (ms)",description:"If the device supports vibration with 'Navigator.vibrate', it will vibrate for the duration set here on touch down.Set to 0 to disable."}),TouchButton.prototype.initialize=function(){window.touchJoypad&&void 0!==window.touchJoypad.buttonStates[this.identifier]?console.warn("Touch button identifier already used, please use another for Entity: "+this.entity.name):(this._canVibrate=!!navigator.vibrate,this._setState(!1),this.on("state",(t=>{this._setEvents(t?"on":"off")})),this.on("destroy",(()=>{window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=void 0)})),this._setEvents("on"))},TouchButton.prototype._setEvents=function(t){this._state=!1,this.entity.element[t]("mousedown",this._onMouseDown,this),this.entity.element[t]("mouseup",this._onMouseUp,this),this.app.touch&&(this.entity.element[t]("touchstart",this._onTouchDown,this),this.entity.element[t]("touchend",this._onTouchUp,this),this.entity.element[t]("touchcancel",this._onTouchUp,this))},TouchButton.prototype._onMouseDown=function(t){this._state||(this._onPointerDown(),t.stopPropagation())},TouchButton.prototype._onMouseUp=function(t){this._state&&(this._onPointerUp(),t.stopPropagation())},TouchButton.prototype._onTouchDown=function(t){this._state||(this._onPointerDown(),t.stopPropagation())},TouchButton.prototype._onTouchUp=function(t){this._state&&(this._onPointerUp(),t.stopPropagation()),t.event.preventDefault()},TouchButton.prototype._onPointerDown=function(){this._canVibrate&&0!==this.vibration&&navigator.vibrate(this.vibration),this._setState(!0)},TouchButton.prototype._onPointerUp=function(){this._setState(!1)},TouchButton.prototype._setState=function(t){window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=t?Date.now():null),this._state=t};!function(){const t={},n={},o={buttons:{isPressed:function(t){return!!n[t]},wasPressed:function(o){const e=n[o],s=t[o];return void 0!==n[o]&&(!s&&e)},wasReleased:function(o){const e=n[o],s=t[o];return void 0!==n[o]&&(s&&!e)},wasTapped:function(n){if(this.wasReleased(n)){return Date.now()-t[n]<=200}return!1}},sticks:{}};o.buttonStates=n;pc.Application.getApplication().on("update",(()=>{for(const o of Object.keys(n)){const e=n[o];t[o]=e}})),window.touchJoypad=o}();var TouchJoystick=pc.createScript("touchJoystick");TouchJoystick.attributes.add("identifier",{type:"string",default:"joystick0",title:"Idenitifier",description:"A unique name for the joystick to refer to it by in the API. Joysticks are also buttons so this will also be the name of button in the API. It will give a warning in browser tools if the name is not unique."}),TouchJoystick.attributes.add("type",{type:"string",default:"fixed",enum:[{"Fixed in place":"fixed"},{"Move to first touch and fixed":"relative"},{"Move to first touch and drags":"drag"}],title:"Type",description:"Set type of behavior for the joystick."}),TouchJoystick.attributes.add("baseEntity",{type:"entity",title:"Base Entity",description:"Image Element Entity that shows the base of the joystick."}),TouchJoystick.attributes.add("nubEntity",{type:"entity",title:"Nub Entity",description:"Image Element Entity that shows the nub (top) of the joystick."}),TouchJoystick.attributes.add("axisDeadZone",{type:"number",default:10,title:"Axis Dead Zone",description:"The number of UI units from the position of the Base Entity where input is not registered."}),TouchJoystick.attributes.add("axisRange",{type:"number",default:50,title:"Axis Range",description:"The number of UI units from the position of the Base Entity that the Nub Entity can move to and is the maximum range"}),TouchJoystick.attributes.add("hideOnRelease",{type:"boolean",default:!1,title:"Hide on Release",description:"Will only show the joystick when the user is using it and will hide it on touch end. This is commonly used if you don't want the joystick to block what's being shown on screen."}),TouchJoystick.attributes.add("positionOnRelease",{type:"string",default:"stay",enum:[{Stay:"stay"},{Original:"original"},{"Last start":"lastStart"}],title:"Position on Release",description:"Where to move the joystick on release and can help keep the screen tidy so that there are clear areas to show the game and arrange controls."}),TouchJoystick.attributes.add("vibrationPress",{type:"number",default:0,title:"Vibration duration (ms)",description:"If the device supports vibration with 'Navigator.vibrate', it will vibrate for the duration set here on touch down.Set to 0 to disable."}),TouchJoystick.prototype.initialize=function(){window.touchJoypad&&void 0!==window.touchJoypad.sticks[this.identifier]?console.warn("Touch joystick identifier already used, please use another for Entity: "+this.entity.name):(this._originalLocalPosition=this.baseEntity.getLocalPosition().clone(),this._lastPointerDownPosition=new pc.Vec3,this._setAxisValues(0,0),this._inputDown=!1,this._pointerId=-1,this._canVibrate=!!navigator.vibrate,this._setButtonState(!1),this.on("state",(t=>{this._setEvents(t?"on":"off")})),this.on("destroy",(()=>{window.touchJoypad&&(window.touchJoypad.sticks[this.identifier]=void 0)})),this._setEvents("on"))},TouchJoystick.prototype._setEvents=function(t){this._setAxisValues(0,0),this._pointerDown=!1,this._pointerId=-1,this.baseEntity.enabled=!this.hideOnRelease,this.entity.element[t]("mousedown",this._onMouseDown,this),this.entity.element[t]("mousemove",this._onMouseMove,this),this.entity.element[t]("mouseup",this._onMouseUp,this),this.app.touch&&(this.entity.element[t]("touchstart",this._onTouchDown,this),this.entity.element[t]("touchmove",this._onTouchMove,this),this.entity.element[t]("touchend",this._onTouchUp,this),this.entity.element[t]("touchcancel",this._onTouchUp,this))},TouchJoystick.__uiPos=new pc.Vec2,TouchJoystick.prototype.screenToUi=function(t){const i=TouchJoystick.__uiPos,o=this.app.graphicsDevice.canvas.clientWidth,e=this.app.graphicsDevice.canvas.clientHeight;return i.x=t.x/o,i.y=t.y/e,i.mulScalar(2).subScalar(1),i.y*=-1,i},TouchJoystick.prototype._onMouseDown=function(t){t.id=0,this._onPointerDown(t),this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onMouseMove=function(t){t.id=0,this._onPointerMove(t),this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onMouseUp=function(t){t.id=0,this._pointerDown&&t.stopPropagation(),this._onPointerUp(t)},TouchJoystick.prototype._onTouchDown=function(t){if(this._pointerDown)return;const i=this._pointerDown;t.id=t.touch.identifier,this._onPointerDown(t),!i&&this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onTouchMove=function(t){t.id=t.touch.identifier,this._onPointerMove(t),this._pointerDown&&t.stopPropagation(),t.event.preventDefault()},TouchJoystick.prototype._onTouchUp=function(t){this._pointerDown&&(t.id=t.touch.identifier,this._onPointerUp(t),t.stopPropagation()),t.event.preventDefault()},TouchJoystick.prototype._onPointerDown=function(t){const i=this.screenToUi(t);switch(this.type){case"drag":case"relative":this.baseEntity.setPosition(i.x,i.y,0),this.nubEntity.setLocalPosition(0,0,0),this._pointerDown=!0;break;case"fixed":this.nubEntity.setPosition(i.x,i.y,0),this._updateAxisValuesFromNub(),this._pointerDown=!0}this._pointerDown&&(this._canVibrate&&0!==this.vibrationPress&&navigator.vibrate(this.vibrationPress),this._pointerId=t.id?t.id:0,this._setButtonState(!0),this._lastPointerDownPosition.copy(this.baseEntity.getLocalPosition()),this.baseEntity.enabled=!0,this._onPointerMove(t))},TouchJoystick.__tempNubPos=new pc.Vec3,TouchJoystick.__tempBasePos=new pc.Vec3,TouchJoystick.prototype._onPointerMove=function(t){if(this._pointerDown&&this._pointerId==t.id){const i=this.screenToUi(t),o=this.axisRange*this.axisRange;this.nubEntity.setPosition(i.x,i.y,0);const e=TouchJoystick.__tempNubPos;e.copy(this.nubEntity.getLocalPosition());if(e.lengthSq()>=o){if("drag"===this.type){const t=e.length()-this.axisRange,i=TouchJoystick.__tempBasePos;i.copy(e),i.normalize().mulScalar(t),i.add(this.baseEntity.getLocalPosition()),this.baseEntity.setLocalPosition(i)}e.normalize().mulScalar(this.axisRange),this.nubEntity.setLocalPosition(e)}this._updateAxisValuesFromNub()}},TouchJoystick.prototype._onPointerUp=function(t){if(this._pointerDown&&this._pointerId==t.id){switch(this.nubEntity.setLocalPosition(0,0,0),this.hideOnRelease&&(this.baseEntity.enabled=!1),this.positionOnRelease){case"original":this.baseEntity.setLocalPosition(this._originalLocalPosition);break;case"lastStart":this.baseEntity.setLocalPosition(this._lastPointerDownPosition)}this._pointerId=-1,this._updateAxisValuesFromNub(),this._setButtonState(!1),this._pointerDown=!1}},TouchJoystick.prototype._updateAxisValuesFromNub=function(){const t=this.axisRange-this.axisDeadZone,i=this.nubEntity.getLocalPosition(),o=Math.sign(i.x),e=Math.sign(i.y),s=pc.math.clamp(Math.abs(i.x)-this.axisDeadZone,0,t)*o,n=pc.math.clamp(Math.abs(i.y)-this.axisDeadZone,0,t)*e;this._setAxisValues(s/t,n/t)},TouchJoystick.prototype._setAxisValues=function(t,i){window.touchJoypad&&(window.touchJoypad.sticks[this.identifier]={x:t,y:i}),this.axisX=t,this.axisY=i},TouchJoystick.prototype._setButtonState=function(t){window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=t?Date.now():null),this._state=t};!function(){const t={},n={},o={buttons:{isPressed:function(t){return!!n[t]},wasPressed:function(o){const e=n[o],s=t[o];return void 0!==n[o]&&(!s&&e)},wasReleased:function(o){const e=n[o],s=t[o];return void 0!==n[o]&&(s&&!e)},wasTapped:function(n){if(this.wasReleased(n)){return Date.now()-t[n]<=200}return!1}},sticks:{}};o.buttonStates=n;pc.Application.getApplication().on("update",(()=>{for(const o of Object.keys(n)){const e=n[o];t[o]=e}})),window.touchJoypad=o}();var TouchButton=pc.createScript("touchButton");TouchButton.attributes.add("identifier",{type:"string",default:"button0",title:"Identifier",description:"A unique name for the button to refer to it by in the API. Will give a warning in browser tools if the name is not unique."}),TouchButton.attributes.add("vibration",{type:"number",default:0,title:"Vibration duration (ms)",description:"If the device supports vibration with 'Navigator.vibrate', it will vibrate for the duration set here on touch down.Set to 0 to disable."}),TouchButton.prototype.initialize=function(){window.touchJoypad&&void 0!==window.touchJoypad.buttonStates[this.identifier]?console.warn("Touch button identifier already used, please use another for Entity: "+this.entity.name):(this._canVibrate=!!navigator.vibrate,this._setState(!1),this.on("state",(t=>{this._setEvents(t?"on":"off")})),this.on("destroy",(()=>{window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=void 0)})),this._setEvents("on"))},TouchButton.prototype._setEvents=function(t){this._state=!1,this.entity.element[t]("mousedown",this._onMouseDown,this),this.entity.element[t]("mouseup",this._onMouseUp,this),this.app.touch&&(this.entity.element[t]("touchstart",this._onTouchDown,this),this.entity.element[t]("touchend",this._onTouchUp,this),this.entity.element[t]("touchcancel",this._onTouchUp,this))},TouchButton.prototype._onMouseDown=function(t){this._state||(this._onPointerDown(),t.stopPropagation())},TouchButton.prototype._onMouseUp=function(t){this._state&&(this._onPointerUp(),t.stopPropagation())},TouchButton.prototype._onTouchDown=function(t){this._state||(this._onPointerDown(),t.stopPropagation())},TouchButton.prototype._onTouchUp=function(t){this._state&&(this._onPointerUp(),t.stopPropagation()),t.event.preventDefault()},TouchButton.prototype._onPointerDown=function(){this._canVibrate&&0!==this.vibration&&navigator.vibrate(this.vibration),this._setState(!0)},TouchButton.prototype._onPointerUp=function(){this._setState(!1)},TouchButton.prototype._setState=function(t){window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=t?Date.now():null),this._state=t};